<!doctype html>

<html>
  <head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <title>test - phina.js</title>
    <meta name="description" content="${description}" />

    <script src="http://cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.js"></script>
    <script src="http://rawgit.com/phi-jp/riot/build/dist/riot/riot+compiler.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/0.15.7/superagent.js"></script>
    <script src="http://cdn.rawgit.com/phi-jp/high/0.0.3/high.js"></script>

    <!-- material design lite -->
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script>

    <!-- test helper -->
    <script src='./testhelper.js'></script>
  </head>
  <body>
    <app></app>
  </body>
</html>

<script type='riot/tag' template='jade'>
  app
    div.
      <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer
                  mdl-layout--overlay-drawer-button">
        <phina-nav sections='{this.sections}'></phina-nav>
        <phina-main></phina-main>
      </div>
    script(type='text/javascript').
      this.sections = opts.sections;
</script>

<script type='riot/tag' template='jade'>
  phina-nav.mdl-layout__drawer
    span.mdl-layout-title phina.js
    nav.mdl-navigation
      itemgroup(each='{sections}')

    script(type='text/javascript').
      this.sections = opts.sections;
</script>

<script type='riot/tag' template='jade'>
  phina-main.mdl-layout__content
    div.page-content
      iframe(name='preview', style='position:absolute;height:100%;')
</script>

<script type='riot/tag' template='jade'>
  itemgroup
    div(class='{opened:this.open}')
      a.mdl-navigation__link(href='', onclick='{toggle}') {name}
        i.material-icons.md-18 keyboard_arrow_down
      nav
        item(each='{items}')

    style(scoped='scoped').
      itemgroup div > a.mdl-navigation__link {
        padding-left: 14px !important;
      }
      itemgroup div.opened > a {
        background: hsl(0, 0%, 90%);
      }
      itemgroup div a.mdl-navigation__link i {
        position: absolute;
        right: 5px;
        -webkit-transition: 200ms;
      }
      itemgroup div.opened a.mdl-navigation__link i {
        -webkit-transform: rotate(-180deg);
      }
      itemgroup nav {
        max-height: 0px;
        overflow: hidden;
        -webkit-transition: 200ms;
      }
      itemgroup .opened nav {
        max-height: 500px;
        overflow: scroll;
        -webkit-transition: 200ms;
      }
    script(type='text/javascript').
      this.open = true;

      this.toggle = function() {
        this.open = !this.open;
      };
</script>

<script type='riot/tag' template='jade'>
  item
    a.mdl-navigation__link(href='{link}', target='preview') {name}
</script>

<!--
    <script src='./graphics/canvas.js'></script>
  -->

<script>

  var data = {
    sections: [{
      name: 'core',
      items: [
        {name:'object',},
        {name:'number',},
        {name:'string',},
        {name:'array',},
        {name:'function',},
        {name:'date',},
        {name:'math',},
      ],
    }],
  };

  th.load('config.json', function(d) {
    var files = [];
    d.files.each(function(file) {
      files.push(file);
    });

    th.loadScripts(files, function() {
      // // マウントする
      var json = th.toJSON('templates/simple.html?{link}');

      json.forEach(function(s) {
        data.sections.push(s);
      });

      riot.update();
    });
  });

  riot.mount('app', data);

</script>
