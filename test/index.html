<!doctype html>

<html>
  <head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <title>test - phina.js</title>
    <meta name="description" content="${description}" />

    <script src="http://cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.js"></script>
    <script src="http://rawgit.com/phi-jp/riot/build/dist/riot/riot+compiler.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/0.15.7/superagent.js"></script>
    <script src="http://cdn.rawgit.com/phi-jp/high/0.0.3/high.js"></script>

    <!-- material design lite -->
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script>

    <!-- test helper -->
    <script src='./testhelper.js'></script>
  </head>
  <body>
    <app></app>
  </body>
</html>

<script type='riot/tag' template='jade'>
  app
    div.
      <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer
                  mdl-layout--overlay-drawer-button">
        <phina-nav sections='{this.sections}'></phina-nav>
        <phina-main></phina-main>
      </div>
    script(type='text/javascript').
      this.sections = opts.sections;
</script>

<script type='riot/tag' template='jade'>
  phina-nav.mdl-layout__drawer
    span.mdl-layout-title phina.js
    nav.mdl-navigation
      div.mdl-navigation__link
        search(oninput='{search}')
      itemgroup(each='{sections.filter(filter)}', data='{this}')
    style.
      div.mdl-navigation__link {
        padding: 0px 10px !important;
      }

    script(type='text/javascript').
      this.sections = opts.sections;

      var searchValue = '';

      this.search = function(event) {
        searchValue = event.target.value;
        this.update();
      };
      this.filter = function(item) {
        if (searchValue) {
          var flag = item.name.indexOf(searchValue);
          return flag !== -1;
        }
        else {
          return true;
        }
      };
</script>

<script type='riot/tag' template='jade'>
  phina-main.mdl-layout__content
    div.page-content
      iframe(name='preview', style='position:absolute;height:100%;')
</script>

<script src='tags/search.jade' type='riot/tag' template='jade'></script>
<script src='tags/item.jade' type='riot/tag' template='jade'></script>
<script src='tags/itemgroup.jade' type='riot/tag' template='jade'></script>


<script>
  riot.compile(function() {
    componentHandler.upgradeDom();
  });

  var hash = location.hash.substr(1);
  var data = {
    sections: [
      {
        name: 'core',
        items: [
          {name:'object',},
          {name:'number',},
          {name:'string',},
          {name:'array',},
          {name:'function',},
          {name:'date',},
          {name:'math',},
        ],
      }
    ],
  };

  th.load('config.json', function(d) {
    var files = [];
    d.files.each(function(file) {
      files.push(file);
    });

    th.loadScripts(files, function() {
      // // マウントする
      var json = th.toJSON('templates/simple.html?{link}');

      json.forEach(function(s) {
        data.sections.push(s);
        s.open = true;
      });

      riot.update();
    });
  });

  riot.mount('app', data);

</script>
