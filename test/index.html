<!doctype html>

<html>
  <head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <title>test - phina.js</title>
    <meta name="description" content="${description}" />

    <script src="http://cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.js"></script>
    <script src="http://rawgit.com/phi-jp/riot/build/dist/riot/riot+compiler.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/superagent/0.15.7/superagent.js"></script>
    <script src="http://cdn.rawgit.com/phi-jp/high/0.0.3/high.js"></script>

    <!-- material design lite -->
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script>

    <!-- test helper -->
    <script src='./testhelper.js'></script>
  </head>
  <body>
    <app></app>
  </body>
</html>

<script type='riot/tag' template='jade'>
  app
    div.
      <div class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer
                  mdl-layout--overlay-drawer-button">
        <phina-nav sections='{this.sections}'></phina-nav>
        <phina-main></phina-main>
      </div>
    script(type='text/javascript').
      this.sections = opts.sections;
</script>

<script type='riot/tag' template='jade'>
  phina-nav.mdl-layout__drawer
    span.mdl-layout-title phina.js
    nav.mdl-navigation
      div.mdl-navigation__link
        phina-search(oninput='{search}')
      itemgroup(each='{sections.filter(filter)}', data='{this}')
    style.
      div.mdl-navigation__link {
        padding: 0px 10px !important;
      }

    script(type='text/javascript').
      this.sections = opts.sections;

      var searchValue = '';

      this.search = function(event) {
        searchValue = event.target.value;
        this.update();
      };
      this.filter = function(item) {
        if (searchValue) {
          var flag = item.name.indexOf(searchValue);
          return flag !== -1;
        }
        else {
          return true;
        }
      };
</script>

<!-- 検索 -->
<script type='riot/tag' template='jade'>
  phina-search.mdl-textfield.mdl-js-textfield
    input.mdl-textfield__input(name='_value', type='text')
    label.mdl-textfield__label
      i.material-icons search
    style(scoped).
      phina-search {
        width: 100% !important;
      }
      phina-search i.material-icons {
        position: absolute;
        top: -2px;
      }
</script>

<script type='riot/tag' template='jade'>
  phina-main.mdl-layout__content
    div.page-content
      iframe(name='preview', style='position:absolute;height:100%;')
</script>

<script type='riot/tag' template='jade'>
  itemgroup
    div(class='{opened:_open}')
      a.mdl-navigation__link(href='', onclick='{toggle}') {name}
        i.material-icons.md-18 keyboard_arrow_down
      nav
        item(each='{items}')

    style(scoped='scoped').
      itemgroup div > a.mdl-navigation__link {
        padding-left: 14px !important;
      }
      itemgroup div.opened > a {
        background: hsl(0, 0%, 90%);
      }
      itemgroup div a.mdl-navigation__link i {
        position: absolute;
        right: 5px;
        -webkit-transition: 200ms;
      }
      itemgroup div.opened a.mdl-navigation__link i {
        -webkit-transform: rotate(-180deg);
      }
      itemgroup nav {
        max-height: 0px;
        overflow: hidden;
        -webkit-transition: 200ms;
      }
      itemgroup .opened nav {
        max-height: 500px;
        overflow: scroll;
        -webkit-transition: 200ms;
      }
    script(type='text/javascript').
      this._open = opts.data.open;

      this.toggle = function() {
        this._open = !this._open;
      };
</script>

<script type='riot/tag' template='jade'>
  item
    a.mdl-navigation__link(href='{link}', target='preview', onclick='{click}') {name}

    script(type='text/javascript').
      this.click = function() {
        location.hash = this.path;
        return true;
      };
</script>

<script>
  var hash = location.hash.substr(1);
  var data = {
    sections: [
      {
        name: 'core',
        items: [
          {name:'object',},
          {name:'number',},
          {name:'string',},
          {name:'array',},
          {name:'function',},
          {name:'date',},
          {name:'math',},
        ],
      }
    ],
  };

  th.load('config.json', function(d) {
    var files = [];
    d.files.each(function(file) {
      files.push(file);
    });

    th.loadScripts(files, function() {
      // // マウントする
      var json = th.toJSON('templates/simple.html?{link}');

      json.forEach(function(s) {
        data.sections.push(s);
        s.open = true;
      });

      riot.update();
    });
  });

  riot.mount('app', data);

</script>
