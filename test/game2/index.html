<!doctype html>

<html>
  <head>
    <meta charset='utf-8' />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <title>test - phina.js</title>
    <meta name="description" content="${description}" />

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <!-- materialize -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.96.1/css/materialize.min.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.96.1/js/materialize.min.js'></script>

    <!-- jade -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jade/1.3.1/jade.js"></script>
    <!-- riot -->
    <script src="http://rawgit.com/phi-jp/riot/build/dist/riot/riot+compiler.js"></script>
    <!-- high -->
    <script src="http://cdn.rawgit.com/phi-jp/high/0.0.3/high.js"></script>
    <!-- jframe -->
    <script src='http://cdn.rawgit.com/phi-jp/jframe/0.0.1/jframe.js'></script>

    <!-- test helper -->
    <script src='./../game/testhelper.js'></script>

    <!-- test files -->
    <script src='./../game/src/display/index.js'></script>
  </head>
  <body>
    <app></app>
  </body>
</html>

<script type='riot/tag' template='jade'>
  app
    side
</script>

<script type='riot/tag' template='jade'>
  side
    nav
      ul#mobile-nav.side-nav.fixed
        li.search
          div.input-field
            input#search(type='search')
            label
              i.mdi-action-search
            i.mdi-navigation-close
        li(each='{sections}')
          a(href='') {name}
      a.button-collapse(href='', data-activates="mobile-nav")
        i.mdi-navigation-menu

    style.
      side {
        display: block;
      }
      side nav ul li.search {
        padding-left: 0px;
        padding-right: 0px;
        background-color: hsl(0, 100%, 70%);
      }
      side nav ul li.search i.mdi-action-search {
        font-size: 2rem;
      }

    script.
      this.sections = window.sections;

</script>


<script>
  var hash = location.hash.substr(1);
  var data = {
    sections: [],
  };

  // // マウントする
  var json = th.toJSON('');
  console.log(json);
  window.sections = json;

  json.forEach(function(s) {
    data.sections.push(s);

    var matchedItems = s.items.filter(function(item) {
      return item.path === hash;
    });

    if (matchedItems.length > 0) {
      var code = (function() {
        var code = th.code(matchedItems[0].path);
        var lines = code.split('\n');
        lines.splice(0, 1);
        lines.splice(lines.length-1, 1);
        return lines.join('\n');
      })();

      var a = $.ajax({
        url: 'templates/display.html',
      });
      a.done(function(res) {
        var html = res.replace('{{code}}', code);
        preview.load(html);
      });

      s.open = true;
    }
  });

  riot.mount('app', data);

</script>
